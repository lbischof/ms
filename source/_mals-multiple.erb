<% if not pdata.product %>
    <% raise "#{get_current_page}: product is empty" %>
<% end %>
<% if pdata.radios and pdata.price %>
    <% raise "#{get_current_page}: price and radios" %>
<% end %>
<% if !pdata.radios and !pdata.price %>
    <% raise "#{get_current_page}: product has no price" %>
<% end %>
<% pdata.images = true if not defined? pdata.images %>

<%= banner_image_tag pdata[:product] if pdata.banner %>
<section class="mals-multiple<%= " #{sanitize pdata.product}" if pdata.product %><%= " textboxes" if pdata.textboxes %>"<%= " style=\"color: #{pdata.text_colour}\"" if pdata.text_colour %>>
    <% if pdata.description %>
        <div class="description">
            <%= markdown pdata.description %>
        </div>
    <% end %>
    <form action="http://ww8.aitsafe.com/cf/addmulti.cfm" method="post">
        <input type="hidden" name="userid" value="A4132041">
        <input type="hidden" name="return" value="<%= config.url_root %><%= current_page.url %>">
        <% if pdata.colours %>
            <% pdata.colours.each do |colour| %>
                <%# Check if it's a hash %>
                <% if colour.respond_to?(:each_pair) %>
                    <% colour, options = colour.first %>
                <% end %>
                <div class="colours">
                    <%= colour_image_tag(pdata.product, colour) if pdata.images %>
                    <%= "<label>" if not pdata.textboxes %>
                        <input type="checkbox" name="product1[]" value="<%= colour %>">
                    <%= "<label>" if pdata.textboxes %>
                        <span<%= " style=\"color: #{options.colour}\"" if options && options.colour %>><%= colour %></span>
                        <% if options && options.gauge %>
                            <%= options.gauge %>
                        <% end %>
                        <% if options && options.usage %>
                            <br><%= options.usage %>
                        <% end %>
                        <% if pdata.textboxes %>
                            <input type="number" min="1" name="product1[]">
                        <% end %>
                    </label>
                </div>
            <% end %>
        <% end %>
        <div class="radios">
            <% if pdata.radios %>
                <%# radios is an array of single hashes %>
                <% pdata.radios.each_with_index do |radio, index| %>
                    <label>
                        <input name="productpr1" type="<%= pdata.radios.length == 1 ? "hidden" : "radio" %>" value="<%= pdata[:product] %>, <%= "%s :%s" % radio.first %>"<%= " checked" if pdata.radios.length == 1 or index == 1 %>>
                        <%= radio.keys.first %> <%= number_to_currency(radio.values.first, :unit => "$").sub(/\.00$/, '.-') %>
                    </label>
                <% end %>
            <% else %>
                <input type="hidden" name="productpr1" value="<%= pdata[:product] %>, :<%= pdata[:price] %>">
            <% end %>
            <input type="hidden" name="noqty1" value="1">
            <input type="hidden" name="qty1">
            <noscript>
                <p>Please add up how many total: <input type="number" name="qty1"></p>
            </noscript>

            <button>Cart</button>
        </div>
    </form>
</section>
